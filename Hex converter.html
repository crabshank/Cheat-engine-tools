<html>

<head>
<meta charset="UTF-8">
<style>
button,select{
	background-color: buttonface !important;
}	
button,option{
	color: black !important;
}
button.offst_pnb{
    min-height: 2ch;
    text-align: center;
    vertical-align: middle;
	min-width: 4.4ch;
}
section#anly_info > section {
	margin-right: 2.73ch;
    margin-bottom: 2.73ch;
}
section#anly_info > section * {
	text-align: left;
}
#anly_info section:hover, #hex span:hover{
    background-color:hsl(129deg 55% 16%);
}
#hex span:hover{
	cursor:none;
}
#hex span.prospective{
    background-color:hsl(208deg 68% 34%);
	cursor:none;
}
 #hex span.AOB_found{
   background-color: hsl(259deg 42% 35%);
	cursor:none;
}
section#anly_info > section.tracked, #hex span.base_span{
    background-color: hsl(46deg 90% 28%);
}
section#anly_info > section div {
    width: max-content;
}
body {
    background-color: hsl(0 0% 8% / 1);
    color: white;
}
div[contenteditable="true"] {
    min-width: 30ch;
    border: 1px outset #dadada;
    margin-left: 0.5ch;
    padding: 0.4ch;
}
div[contenteditable="true"].num {
    width: 8ch !important;
    min-width: max-content !important;
	display: inline-block;
}
label {
    white-space: nowrap;
}
#scrlr_hl div {
    width: max-content;
}
#hex span{
    margin: 0ch 0.83ch 0ch 0ch;
    white-space: nowrap;
    padding: 0ch 0.27ch 0ch 0ch;
    border: 0;
}
</style>
</head>
	
<body>
<title>Hex converter</title>
<h1 style="margin: 0px; padding: 0px 0px 8px 0px; text-align: center;">Hex converter</h1>
<section id="scrlr" style="top: 0; left:0; position: absolute; z-index: 1;background: hsl(0 0% 8% / 1);max-height: 97.2vh;overflow-y: overlay;">
		<section id="scrlr_CE">
			
		</section>
		<div id="scrlr_ttl" style="margin-bottom: 0.6ch;font-weight: bold;"></div>
			<section id="scrlr_hl" style="max-width: max-content;"></section>
</section>

<section id="hex_sct"  style="display: inline-flex; flex-flow: column nowrap; place-content: flex-start;max-width: 37.5%;width: 37.5%;min-height: 92%;">
	<div contenteditable id="hex_search_AOB" style="border: 1px solid #886a0773;min-width: -webkit-fill-available;color: buttonface;">Search for AOB</div>
	<div contenteditable id="hex" style="min-height: 92%;display: inline-flex;border: 1px solid #886a0773;flex-flow: wrap;place-content: flex-start; height: 87vh;"></div>
</section>

<section id="anly" style="width: 61.96%;height: 92%;float: right;transform: translateX(0.54%);">
	<section id="anly_btns">
		<button id="bse" baseByte="0">Set as base</button>
		<button id="jmb">Jump to base</button>
	</section>
	<section id="anly_info">
	</section>
</section>

<script>
var pastd=[];

function selDivEditable(el){
	try{
			let range = document.createRange();
			let sel = window.getSelection();
			let sp=[...el.childNodes];
			let spe=(sp.length>0)?sp.at(-1):el;
		  let spc=Math.max(spe?.nodeValue?.length || 1,1);
		  el.focus();
		   range.setStart(spe,spc);
			range.collapse(true);
			
			sel.removeAllRanges();
			sel.addRange(range);
	}catch(e){;}
}

function elRemover(el){
	if(typeof el!=='undefined' && !!el){
	if(typeof el.parentNode!=='undefined' && !!el.parentNode){
		el.parentNode.removeChild(el);
	}
	}
}

function get_subarray(a, f, t) {
    return a.slice(f, t+1);
}

 function getNoDigits(n){
		return Math.max(1, Math.floor(Math.log10(Math.abs(n))+1) );
}

function getSigFig_dp(n,d){
	if(isFinite(n)){
		return Math.max(0, d+1-getNoDigits(n) );
	}else{
		return d;
	}
}

function absBoundingClientRect(el){
	let st = [window?.scrollY,
					window?.pageYOffset,
					el?.ownerDocument?.documentElement?.scrollTop,
					document?.documentElement?.scrollTop,
					document?.body?.parentNode?.scrollTop,
					document?.body?.scrollTop,
					document?.head?.scrollTop];
					
		let sl = [window?.scrollX,
						window?.pageXOffset,
						el?.ownerDocument?.documentElement?.scrollLeft,
						document?.documentElement?.scrollLeft,
						document?.body?.parentNode?.scrollLeft,
						document?.body?.scrollLeft,
						document?.head?.scrollLeft];
						
				let scrollTop=0;
				for(let k=0; k<st.length; k++){
					if(!!st[k] && typeof  st[k] !=='undefined' && st[k]>0){
						scrollTop=(st[k]>scrollTop)?st[k]:scrollTop;
					}
				}			

				let scrollLeft=0;
				for(let k=0; k<sl.length; k++){
					if(!!sl[k] && typeof  sl[k] !=='undefined' && sl[k]>0){
						scrollLeft=(sl[k]>scrollLeft)?sl[k]:scrollLeft;
					}
				}
	
	const rct=el.getBoundingClientRect();
	let r={};

	r.left=rct.left+scrollLeft;
	r.right=rct.right+scrollLeft;
	r.top=rct.top+scrollTop;
	r.bottom=rct.bottom+scrollTop;
	r.height=rct.height;
	r.width=rct.width;
	
	return r;
}

function getBarSepStr(a,m,x){
	if(typeof a!=='undefined'){
		let out='';
		let ot='';
		let opts={useGrouping: false, minimumFractionDigits: m, maximumFractionDigits: x};
		for(let i=0, len=a.length; i<len; i++){

			if(typeof a[i]!=='undefined' && typeof a[i].s!=='undefined'){
				let q=(a[i].u==a[i].s)?true:false;
				if(!q){
					out+='(';
				}
					opts.maximumFractionDigits=getSigFig_dp(a[i].u,x);
					out+=a[i].u.toLocaleString('en-GB',opts);
					if(!q){
						out+=', ';
						opts.maximumFractionDigits=getSigFig_dp(a[i].s,x);
						out+=a[i].s.toLocaleString('en-GB',opts);
						out+=')';
				}
			}else if(typeof a[i]==='string'){
				ot=a[i];
				out+='"'+ot+'"';
			}else if(isNaN(a[i])){
				out+='❌';
			}else if(typeof a[i]==='number'){
				let d=getNoDigits(a[i]);
				if(d>=x){
					ot=a[i].toExponential(x);
				}else{
						opts.maximumFractionDigits=Math.max(0, x+1-d );
						ot=a[i].toLocaleString('en-GB',opts);
				}
				out+=ot;
			}else{
				ot=JSON.stringify(a[i]);
				if(typeof ot==='undefined'|| ot==='undefined'){
					out+='❌';
				}else{
					out+='"'+ot+'"';
				}
			}
			out+=( (i==len-1)? '' : ' | ' );
		}
		return out;
	}else{
		return '❌';
	}
}

function n_byte_unit8_to_int(a,u_only){
			let us=Number("0x"+a.join(''));
			let out={s: us, u:us};

		if(u_only===true){
			return out;
		}else{
			let mx=2;
			for(let i=0, len=(a.length*8)-1; i<len; i++){
				mx*=2;
			}
			mx-=1;
			
			let h=Math.floor(mx/2);
			
			if(out.u>h){
				out.s=-mx+out.u-1;
			}else{
				out.s=out.u;
			}
			
			return out;
		}
}

const lookup_hex={
										'00':0,
										'01':1,
										'02':2,
										'03':3,
										'04':4,
										'05':5,
										'06':6,
										'07':7,
										'08':8,
										'09':9,
										'0A':10,
										'0B':11,
										'0C':12,
										'0D':13,
										'0E':14,
										'0F':15,
										'10':16,
										'11':17,
										'12':18,
										'13':19,
										'14':20,
										'15':21,
										'16':22,
										'17':23,
										'18':24,
										'19':25,
										'1A':26,
										'1B':27,
										'1C':28,
										'1D':29,
										'1E':30,
										'1F':31,
										'20':32,
										'21':33,
										'22':34,
										'23':35,
										'24':36,
										'25':37,
										'26':38,
										'27':39,
										'28':40,
										'29':41,
										'2A':42,
										'2B':43,
										'2C':44,
										'2D':45,
										'2E':46,
										'2F':47,
										'30':48,
										'31':49,
										'32':50,
										'33':51,
										'34':52,
										'35':53,
										'36':54,
										'37':55,
										'38':56,
										'39':57,
										'3A':58,
										'3B':59,
										'3C':60,
										'3D':61,
										'3E':62,
										'3F':63,
										'40':64,
										'41':65,
										'42':66,
										'43':67,
										'44':68,
										'45':69,
										'46':70,
										'47':71,
										'48':72,
										'49':73,
										'4A':74,
										'4B':75,
										'4C':76,
										'4D':77,
										'4E':78,
										'4F':79,
										'50':80,
										'51':81,
										'52':82,
										'53':83,
										'54':84,
										'55':85,
										'56':86,
										'57':87,
										'58':88,
										'59':89,
										'5A':90,
										'5B':91,
										'5C':92,
										'5D':93,
										'5E':94,
										'5F':95,
										'60':96,
										'61':97,
										'62':98,
										'63':99,
										'64':100,
										'65':101,
										'66':102,
										'67':103,
										'68':104,
										'69':105,
										'6A':106,
										'6B':107,
										'6C':108,
										'6D':109,
										'6E':110,
										'6F':111,
										'70':112,
										'71':113,
										'72':114,
										'73':115,
										'74':116,
										'75':117,
										'76':118,
										'77':119,
										'78':120,
										'79':121,
										'7A':122,
										'7B':123,
										'7C':124,
										'7D':125,
										'7E':126,
										'7F':127,
										'80':128,
										'81':129,
										'82':130,
										'83':131,
										'84':132,
										'85':133,
										'86':134,
										'87':135,
										'88':136,
										'89':137,
										'8A':138,
										'8B':139,
										'8C':140,
										'8D':141,
										'8E':142,
										'8F':143,
										'90':144,
										'91':145,
										'92':146,
										'93':147,
										'94':148,
										'95':149,
										'96':150,
										'97':151,
										'98':152,
										'99':153,
										'9A':154,
										'9B':155,
										'9C':156,
										'9D':157,
										'9E':158,
										'9F':159,
										'A0':160,
										'A1':161,
										'A2':162,
										'A3':163,
										'A4':164,
										'A5':165,
										'A6':166,
										'A7':167,
										'A8':168,
										'A9':169,
										'AA':170,
										'AB':171,
										'AC':172,
										'AD':173,
										'AE':174,
										'AF':175,
										'B0':176,
										'B1':177,
										'B2':178,
										'B3':179,
										'B4':180,
										'B5':181,
										'B6':182,
										'B7':183,
										'B8':184,
										'B9':185,
										'BA':186,
										'BB':187,
										'BC':188,
										'BD':189,
										'BE':190,
										'BF':191,
										'C0':192,
										'C1':193,
										'C2':194,
										'C3':195,
										'C4':196,
										'C5':197,
										'C6':198,
										'C7':199,
										'C8':200,
										'C9':201,
										'CA':202,
										'CB':203,
										'CC':204,
										'CD':205,
										'CE':206,
										'CF':207,
										'D0':208,
										'D1':209,
										'D2':210,
										'D3':211,
										'D4':212,
										'D5':213,
										'D6':214,
										'D7':215,
										'D8':216,
										'D9':217,
										'DA':218,
										'DB':219,
										'DC':220,
										'DD':221,
										'DE':222,
										'DF':223,
										'E0':224,
										'E1':225,
										'E2':226,
										'E3':227,
										'E4':228,
										'E5':229,
										'E6':230,
										'E7':231,
										'E8':232,
										'E9':233,
										'EA':234,
										'EB':235,
										'EC':236,
										'ED':237,
										'EE':238,
										'EF':239,
										'F0':240,
										'F1':241,
										'F2':242,
										'F3':243,
										'F4':244,
										'F5':245,
										'F6':246,
										'F7':247,
										'F8':248,
										'F9':249,
										'FA':250,
										'FB':251,
										'FC':252,
										'FD':253,
										'FE':254,
										'FF':255
									};

let base_hx=null;	
let base_hxi='';	
let indnt=8;					
let ttl=[...document.getElementsByTagName('h1')][0];
let hsrch=document.getElementById('hex_search_AOB');
let hx=document.getElementById('hex');
let anlys=document.getElementById('anly');
let sbse=document.getElementById('bse');
let jmbs=document.getElementById('jmb');
let anlys_i=document.getElementById('anly_info');
let scls={	outer:document.getElementById('scrlr'), 
					hl:document.getElementById('scrlr_hl'),
					ttl:document.getElementById('scrlr_ttl'),
					ce:document.getElementById('scrlr_CE')
				};
				
let base_nm='base';
document.body.onscroll=(event)=>{
	scls.outer.style.top=document.body.scrollTop+'px';
};

let hxBse=0;
let all_hex=[];
var hx_arr=[];
var hx_arr_int=[];
var hx_arr_cnt=0;
var fnd=[];
anlys_i_HTML='';

hsrch.onfocus=(e)=>{
	let t=e.target;
	if(t.innerText==='Search for AOB'){
		t.innerText='';
		t.style.color='white';
	}
}

hsrch.onblur=(e)=>{
	let t=e.target;
	if(t.innerText===''){
		t.innerText='Search for AOB';
		t.style.color='buttonface';
	}
}

function clk_hx(event){
	    let t=event.target;
	if(t.tagName==='SPAN' && t.parentElement===hx){
		let bsps=[...document.querySelectorAll('#hex span')];
		for(let i=0, len=bsps.length; i<len; i++){
			let b=bsps[i];
			if(b === t){
				b.classList.add('prospective');
			}else if(b.classList.contains('prospective')){
				b.classList.remove('prospective');
			}
		}
		let tix=parseInt(t.getAttribute('ix'));
		sbse.setAttribute('baseByte',tix);
		sbse.innerText='Set byte #'+(tix)+' ('+(t.innerText.split(/\s+/)[0])+') as base';
	}
}

hsrch.oninput=(e)=>{
	let t=e.target;
	if(t.innerText!==''){
		//t.style.color='white';
		let b=t.innerText.toLocaleUpperCase().split(/\s+/).join('').match(/([0-9]|[A-F]){1,2}/g);
		t.innerText=b.join(' ');
		let s=[...document.querySelectorAll('#hex span')];
		
		for(let i=0, len=s.length; i<len;i++){
			let sc=s[i];
			if(sc.classList.contains('AOB_found')){
				sc.classList.remove('AOB_found');
			}
		}
		
		let si=0; let s_end=s.length-1;
		let bi=0; let b_end=b.length-1;
		let fnd_AOB=[];
		
		while(si<=s_end){
			if(b[bi]===s[si].innerText.trim()){
				if(bi===b_end){
					bi=0;
					fnd_AOB.push([ si-b_end , si ]);
				}else{
					bi++;
				}
			}else{
				bi=0;
			}
			si++
		}
		
		if(fnd_AOB.length>0){
					let aobd=[...scls.ce.querySelectorAll('#base_AOB')][0];
					aobd.innerText='';
					let at='';
			clk_hx({target: s[fnd_AOB[0][0]] });
			for(let i=0, len=fnd_AOB.length; i<len;i++){
				let sc=fnd_AOB[i][0];
				let sc1=fnd_AOB[i][1];
				let k=sc;
				while(k<=sc1){
					s[k].classList.add('AOB_found');
					if(i===0){
						at+=s[k].innerText.trim()+((k===sc1)?'':' ');
					}
					k++;
				}
			}
			aobd.innerText=at;
		}
		
	}
	 selDivEditable(t);
}



//let hx_print=`<section style="display: flex;flex-flow: row;"><div title="Offset"></div><div></div><div></div></section>`;
function base_cnd(event){
	let k=(event.target.tagName==='SECTION')?event.target:event.target.parentElement;
	let i=parseInt(k.getAttribute('abs_hex'));
	sbse.setAttribute('baseByte',i);
	sbse.innerText='Set byte #'+(i+1)+' ('+k.firstElementChild.nextElementSibling.innerText+') as base';
	sbse.scrollIntoView();
}

function scr_goto(event){
	let i=event.target.parentElement.parentElement.getAttribute('deco');
	let s=[...document.querySelectorAll('#anly_info .hex_offs[deco="'+i+'"]')];
	if(typeof s!=='undefined'){
		s[0].scrollIntoView();
	}
}
function scr_del(event){
	let i=event.target.parentElement.parentElement.getAttribute('deco');
	let s=[...document.querySelectorAll('#anly_info .hex_offs[deco="'+i+'"]')];
	if(typeof s!=='undefined'){
		s[0].click();
	}
}

function pnb_click(event){
	let b=[...document.querySelectorAll('#scrlr_hl section')];
	let j, jp;
	if(event.target.getAttribute('deco')!==null){
		j=event.target.getAttribute('deco');
		jp=parseInt(j);
		let bs=(jp<0)?parseInt(b[0].getAttribute('deco')):parseInt(b.at(-1).getAttribute('deco'));
		let t=[...document.querySelectorAll('section#anly_info > section > div:nth-child(1)[deco="'+(bs+jp)+'"]')][0];
		if(typeof t!=='undefined'){
			hl_sct({currentTarget: t.parentElement});
			b=[...document.querySelectorAll('#scrlr_hl section')];
			if(jp<0){
				b[0].scrollIntoView();
			}else{
				b.at(-1).scrollIntoView();
			}
		}
	}
	
}

function sortByArrCols(arr, colsArr, dir){
    arr.sort(sortFunction);
		function sortFunction(a, b) {
			for(let i = 0; i < arr.length; i++){
					if(a[colsArr[i]]>b[colsArr[i]]){
						return dir[i]*-1;
					}else if(a[colsArr[i]]<b[colsArr[i]]){
						return dir[i]*1;
					}else if(i==arr.length-1){
					return 0;
				}
			} 
	}
}
function addr_nm_bse(event){
	let a=[...document.querySelectorAll('div.offset_addr_nm')];
	let et=event.target.innerText.split(/\s*\(default \=/g)[0];
	for(let i=0, len=a.length; i<len; i++){
		if(a[i].getAttribute('chg')=='false'){
			if(base_nm===''){
				a[i].innerText=et+a[i].innerText;
			}else{
				a[i].innerText=a[i].innerText.split(base_nm).join(et);
			}
		}
	}
	base_nm=et;
}
function chgr(event){
	event.target.setAttribute('chg','true');
}

function auto_hl_2(){
	let len=fnd.length;
	if(fnd.length>0){
		ttl.innerText="Hex converter - Highlighting ("+len+' remaining)';
		fnd[0].click();
		fnd=fnd.slice(1);
		setTimeout(auto_hl_2,0);
	}else{
		ttl.innerText="Hex converter";
	}
}
function un_hl(event){
	fnd=[];
	let scts=[...document.querySelectorAll('#scrlr_hl section')];
	for(let k=scts.length-1; k>=0; k--){
		let i=scts[k].getAttribute('deco');
		let s=[...document.querySelectorAll('#anly_info .hex_offs[deco="'+i+'"]')];
		if(typeof s!=='undefined'){
			s[0].click();
		}
	}
}

function auto_hl(event){
	let t=event.target;
	let els=[...t.parentElement.children];
	let ckb=[els[6].firstElementChild,els[7].firstElementChild]
	let s=[...document.querySelectorAll('#anly_info > section')];
	let ix0=els[1].selectedIndex;
	let ix1=els[2].selectedIndex;
	let m=[	['interps',0,'u'],
					['interps',0,'s'],
					['interps',1,'u'],
					['interps',1,'s'],
					['interps',2,'u'],
					['interps',2,'s'],
					['interps',3,'u'],
					['interps',3,'s'],
					['flt_txt',0],
					['flt_txt',1]
				]; //for non-characters!
	let csv_lst=[];
	let csv_lst_f=[];
	let csv_lst_i=[];
	
	if(ix1==6){
			if(ix0==10){ //Character
					let lst=[...els[3].innerText];
					let lst2=[];
					let crl='';
					for(let j=0, len_j=lst.length; j<len_j; j++){
						let c=lst[j];
						if(c===','){
							if ( j===0 || (j>0 && lst[j-1]==='\\' )   ){
								crl+=c;
							}else{
								lst2.push(crl);
								crl='';
							}
						}else{
							crl+=c;
						}

						if(j===len_j-1 && crl!==''){
							lst2.push(crl);
						}
				} 
				csv_lst=lst2.map((st)=>{return st.split('\\,').join(',');}); 
			}else if(ix0>=8){ //float or double
				csv_lst=els[3].innerText.match(/(-?[0-9]+\.?[0-9]*((e|E){1}(\+|\-){1}[0-9]+)?)/g);
				csv_lst_f=csv_lst.map((c)=>{return parseFloat(c);});
			}else{
				csv_lst=els[3].innerText.match(/\-?[0-9]+/g);
				csv_lst_i=csv_lst.map((c)=>{return parseInt(c);});
			}
	}
	
	for(let i=0, len=all_hex.length;i<len;i++){
		if(ix0==10){ //Character
			if(ix1===1){
				if(all_hex[i]['chrs'].includes(els[3].innerText)){
					fnd.push(s[i]);
				}
			}else{ // in list
				for(let j=0, len_j=csv_lst.length; j<len_j; j++){
					if(all_hex[i]['chrs'].includes(csv_lst[j])){
						fnd.push(s[i]);
					}
				}
			}
		}else{ //numeric
			let vs=[els[3].innerText,els[4].innerText];
			let b=m[ix0];
			if(ix0>7){ //float
					let vsf=[parseFloat(vs[0]),parseFloat(vs[1])];
					let n=null
					let nf=null;
					if(typeof all_hex[i][ b[0] ]!=='undefined' && typeof all_hex[i]['flts']!=='undefined'){
						n=all_hex[i][ b[0] ][ b[1] ]; // float/double text
						nf=all_hex[i]['flts'][ b[1] ]; // float/double
					}
					if(
						(!(ckb[1].checked==true && n.includes('e')) ) &&
						n!==null &&
						n!=='❌'
						){
						if(ix1===0){ //between
							if(nf>=vsf[0] && nf<=vsf[1] && (  !(ckb[0].checked==true && nf===0) )){
								fnd.push(s[i]);
							}
						}else if(ix1===1){ //exactly
							if(vs[0]===n && (  !(ckb[0].checked==true && (n==='0' || n==='-0') ) )){
								fnd.push(s[i]);
							}
						}else if(ix1===2 && (  !(ckb[0].checked==true && (n==='0' || n==='-0')) ) ){ //all
							fnd.push(s[i]);
						}else if(ix1===3){ // >=
							if(nf>=vsf[0] && (  !(ckb[0].checked==true && nf===0) )){
								fnd.push(s[i]);
							}
						}else if(ix1===4){ // <=
							if(nf<=vsf[0] && (  !(ckb[0].checked==true && nf===0) )){
								fnd.push(s[i]);
							}
						}else if (ix1===5){ //=/=
							if(vs[0]!==n && (  !(ckb[0].checked==true && (n==='0' || n==='-0') ) )){
								fnd.push(s[i]);
							}
						}else{ // in list
							for(let j=0, len_j=csv_lst.length; j<len_j; j++){
								let psf=csv_lst_f[j];
								if( ( (csv_lst[j]==='0' || psf===0 || psf=== (-0) ) && (n==='0' || n==='-0') )  || csv_lst[j]===n ){
									fnd.push(s[i]);
									j=len_j-1;
								}
							}
						}
				}
			}else{ //int
				let vsi=[parseInt(vs[0]),parseInt(vs[1])];
				let n=null; // ints
					if(typeof all_hex[i][ b[0] ][ b[1] ]!=='undefined'){
						n=all_hex[i][ b[0] ][ b[1] ][ b[2] ]; // ints
					}
				
				if( 
						(!(ckb[0].checked==true && n===0) ) &&
						n!==null
					){
					if(ix1===0){ //between
						if(n>=vsi[0] && n<=vsi[1]){
							fnd.push(s[i]);
						}
					}else if(ix1===1){ //exactly
						if(vsi[0]===n){
							fnd.push(s[i]);
						}
					}else if(ix1===2){ //all
						fnd.push(s[i]);
					}else if(ix1===3){ // >
						if(n>=vsi[0]){
							fnd.push(s[i]);
						}
					}else if(ix1===4){ // <
						if(n<=vsi[0]){
							fnd.push(s[i]);
						}
					}else if (ix1===5){ //=/=
						if(n!==vsi[0]){
							fnd.push(s[i]);
						}
					}else{
						for(let j=0, len_j=csv_lst.length; j<len_j; j++){
							let psi=csv_lst_i[j];
							if( psi===n ){
								fnd.push(s[i]);
								j=len_j-1;
							}
						}
					}
				}
			}
			
		}
	}
	console.log(fnd);
	document.body.scrollTop=0;
auto_hl_2();
}

function auto_hl_slc(event,num){
	let t=event.target;
	let els=[...t.parentElement.children];
	let si=els[1].selectedIndex;
	let si2=els[2].selectedIndex;

	els[6].style.display='inline-block'; // non-zero float
	els[7].style.display='inline-block'; // non-exp float
	

	
	if(si2>0){ // not between
		els[4].style.display='none';
	}else{
		els[4].style.display='inline-block'; //2nd input
	}
	
	if(si2===2){ //all
		els[3].style.display='none';
	}else{
		els[3].style.display='inline-block'; //1st input
	}
	
	if(si2===6){ // in list
		els[6].style.display='none'; // non-zero float
		els[7].style.display='none'; // non-exp float
	}else{
		els[6].style.display='inline-block'; // non-zero float
		els[7].style.display='inline-block'; // non-exp float
	}
	
	if(si<8){ // int
		els[6].style.display='none';
		els[7].style.display='none';
	}else if(si===10){ // character
		els[6].style.display='none';
		els[7].style.display='none';
		if(si2!==1 && si2!==6){
			els[2].selectedIndex=1;
		}
	}

}

function selectText(element) {
        let selection = window.getSelection();        
        let range = document.createRange();
        range.selectNodeContents(element);
        selection.removeAllRanges();
        selection.addRange(range);
}

function sel_AOB(event){
	selectText(event.target);
}

function addr_nm_chg(event){
	chgr(event);
}
function base_AOB_chg(event){
	base_hxi=event.target.innerText;
	chgr(event);
	scr_left();
}

function addr_type_len(sl,el,base){
		let si=sl.selectedIndex;
		
		if(si<14){
			el.style.display='none';
			let vl=sl.previousElementSibling;
			if(vl.getAttribute('chg')=='false' || base===true){
				let vs=[...el.parentElement.parentElement.children].slice(2);

				if(si>11){ //float 12-13
					let vsFlt=vs[1].innerText.split('||').map((t)=>{return t.split(/\[|\]/g).join('').split(/\s+/g).filter((t1)=>{return t1!==''})});
					let d='';
					if(si===12){
						d=(vsFlt[0]!=='❌')?' (default = '+vsFlt[0]+')':d;
					}else{
						d=(vsFlt[1]!=='❌')?' (default = '+vsFlt[1]+')':d;
					}
					vl.innerText=vl.innerText.split(/\s*\(default \=/g)[0]+d;
				}else{
					let vsInt=vs[0].innerText.split('|').map((t)=>{return t.split(/\[|\]/g).join('').split(/\(|\)|\,|\s+/g).filter((t1)=>{return t1!=='' })});
					let da=[];
					for(let i=0, len=vsInt.length; i<len; i++){
						da.push(vsInt[i][0]);
						da.push(vsInt[i][	(	(vsInt[i].length===2)?1:0	)	]);
						da.push(null);
					}
					
					let d='';
					d=(da[si]!=='❌' && da[si]!==null)?' (default = '+da[si]+')':d;
					vl.innerText=vl.innerText.split(/\s*\(default \=/g)[0]+d;
				}	
			}
		}else{
			el.style.display='block';
		}
}

function gen_ct(event){
	
	let t=[...event.target.parentElement.querySelectorAll('label div[contenteditable="true"]')].map((d)=>{return d.innerText;});
	let nmba=[...event.target.parentElement.querySelectorAll('.offset_addr_nm_base')];
	let nmb='base';
	if(nmba.length>0){
		nmb=nmba[0].innerText;
	}
	let ct=`<?xml version="1.0" encoding="utf-8"?>
<CheatTable CheatEngineTableVersion="42">
  <CheatEntries>
    <CheatEntry>
      <ID>0</ID>
      <Description>"${t[0]}"</Description>
      <Options moHideChildren="1"/>
	  <VariableType>Auto Assembler Script</VariableType>
      <AssemblerScript>[ENABLE]
	  `;
if(t[1]===''){
	ct+=`aobscan(${nmb},${t[2].trim()})`;
}else{
	ct+=`aobscanmodule(${nmb},${t[1]},${t[2].trim()}) // should be unique`;
}


ct+=`  // should be unique
registersymbol(base)

[DISABLE]

</AssemblerScript>
	  <CheatEntries>
	  `;
	  let i=1;
	  let v=[...scls.hl.children];
	  for(let k=0, len=v.length; k<len; k++){
		  let dsc=[...v[k].querySelectorAll('.offset_addr_nm')][0];
		  let sgn=dsc.nextElementSibling;
		  let len=parseInt(sgn.nextElementSibling.value);
		  let si=sgn.selectedIndex;
		  let co=sgn[si];
		  let cov=co.value;
		  let sgn_us=(cov.endsWith(' signed'))?1:0;
		  let sgn_hx=(cov.endsWith(' hex'))?1:0;
		  let typ=cov.split(' ');
		  let ts;
		  if(typ.length>1){
			  ts=get_subarray(typ, 0,typ.length-2 ).join('');
		  }else{
			  ts=typ[0];
		  }
		  ct+=`<CheatEntry>
			  <ID>${i}</ID>
			  <Description>"${dsc.innerText}"</Description>
			  `;
		  if(si<14){
			  ct+=`<ShowAsHex>${sgn_hx}</ShowAsHex>
			  <ShowAsSigned>${sgn_us}</ShowAsSigned>
			  <VariableType>${ts}</VariableType>
			  `;
		  }else if(si<17){ //strings
				let unc=(cov.endsWith(' (Unicode)'))?1:0;
				let cdp=(cov.endsWith(' (Codepage)'))?1:0;
			   ct+=`<VariableType>String</VariableType>
          <Length>${len}</Length>
          <Unicode>${unc}</Unicode>
          <CodePage>${cdp}</CodePage>
          <ZeroTerminate>1</ZeroTerminate>
		  `;
		  }else{ //AOB
			 ct+=`<ShowAsHex>1</ShowAsHex>
          <ShowAsSigned>0</ShowAsSigned>
          <VariableType>Array of byte</VariableType>
          <ByteLength>${len}</ByteLength>
		  `;
		  }
		  let addr=nmb+dsc.parentElement.parentElement.getAttribute('hod');
		  ct+=`<Address>${addr}</Address>
			</CheatEntry>
			`;
		i++;
	  }
	  ct+=`</CheatEntries>
    </CheatEntry>
  </CheatEntries>
  <UserdefinedSymbols/>
</CheatTable>`;
console.log(ct);
	let dl_a=document.createElement('a');
	document.body.appendChild(dl_a);
	let nm=((t[1]==='')? '': (t[1]+'__') )+t[0]+'.CT';
	dl_a.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(ct));
	dl_a.setAttribute('download', nm);
	dl_a.click();
	elRemover(dl_a);
}

function addr_type_sel(event){
	let t=event.target;
	let si=event.target.selectedIndex;
	if(t.classList.contains('addr_type_bse')){
		addr_type_len(t,t.nextElementSibling,true);
		let slcs=[...scls.outer.querySelectorAll('select.addr_type')];
		slcs.forEach((sc)=>{
			if(sc.getAttribute('chg')=='false'){
				sc.selectedIndex=si;
			}
			addr_type_len(sc,sc.nextElementSibling);
		});
	}else{
		addr_type_len(t,t.nextElementSibling);
	}
}

function hl_sct(event){
	let t=event.currentTarget;
	let s=[...document.querySelectorAll('#scrlr_hl section')];
	
	if(t.classList.contains('tracked')){
		t.classList.remove('tracked');
		let hx=t.firstElementChild.getAttribute('hod');
		
		let ix=s.findIndex((c)=>{return c.getAttribute('hod')==hx;});
		if(ix>=0){
			elRemover(s[ix]);
		}
	}else{
		t.classList.add('tracked');
		let tf=t.firstElementChild;
		let hx=tf.getAttribute('hod');
		let dc=parseInt(tf.getAttribute('deco'));
		let srt=s.map((d,index)=>{return [parseInt(d.getAttribute('deco')),d];});
		srt.push([dc,null]);
		 sortByArrCols(srt,[0],[-1]);
		 let isb=[tf.nextElementSibling,tf.nextElementSibling.nextElementSibling,tf.nextElementSibling.nextElementSibling.nextElementSibling,tf.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling];
		let sc=`<section deco=${dc} hod="${hx}" style="margin-bottom: 1.5ch;">
						<div style="display: flex;">
						<div style="margin-right: 0.37ch;">${tf.innerText}</div>
						<div class='offst_pn' style="display: flex;flex-direction: row;">
							<button class='offst_pnb'></button><button class='offst_pnb'></button>
						</div>
							<div style="margin-left: 0.6ch;">${isb[0].innerText}</div>
							<div contenteditable="true" ${(hx==='+0')?'class="offset_addr_nm offset_addr_nm_base" oninput="addr_nm_bse(event);"':'class="offset_addr_nm" oninput="addr_nm_chg(event);" chg="false"'} style="margin-left: 0.6ch;${(hx==='+0')?'border: 2px solid hsl(60deg 74% 53%);"':'border: 2px solid #ff6b00;"'}>${base_nm}${(hx==='+0')?'':hx}</div>
							<select oninput="addr_type_sel(event);" chg="false" class="${(hx==='+0')?'addr_type addr_type_bse':'addr_type'}">
								<option>Byte unsigned</option>
								<option>Byte signed</option>
								<option>Byte hex</option>
								<option>2 Bytes unsigned</option>
								<option>2 Bytes signed</option>
								<option>2 Bytes hex</option>
								<option>4 Bytes unsigned</option>
								<option>4 Bytes signed</option>
								<option>4 Bytes hex</option>
								<option>8 Bytes unsigned</option>
								<option>8 Bytes signed</option>
								<option>8 Bytes hex</option>
								<option>Float</option>
								<option>Double</option>
								<option>String</option>
								<option>String (Unicode)</option>
								<option>String (Codepage)</option>
								<option>Array of byte (hex)</option>
							</select>
							<input display type="number" style="display:none;width: 9.6ch;" title="length" min="1" value="1" step="1" class="${(hx==='+0')?'addr_len addr_len_bse':'addr_len'}"></input>
							<button onclick="scr_goto(event);" style="margin-left: 0.44ch;">Go to</button>
							<button onclick="scr_del(event);" style="margin-left: 0.25ch;">Delete</button>
						</div>
						<div style="${isb[1].style.cssText}">${isb[1].innerText}</div>
						<div style="${isb[2].style.cssText}">${isb[2].innerText}</div>
						<div style="${isb[3].style.cssText}">${isb[3].innerText}</div>
						</section>`;
		let ix=srt.findIndex((a)=>{return a[0]===dc;});
		let lc,lc2;
		if(srt.length===1 || ix<=0){
			lc=scls.hl;
			lc2='afterbegin';
		}else{
			lc=srt[ix-1][1];
			lc2='afterend';
		}
		lc.insertAdjacentHTML(lc2,sc);
		let slcs1=[...scls.outer.querySelectorAll('select.addr_type_bse')];
		slcs1.forEach((slc)=>{
			if(slc.getAttribute('chg')=='false'){
				slc.selectedIndex=12;
				addr_type_len(slc,slc.nextElementSibling,true);
			}
		});
		let slcs=[...scls.outer.querySelectorAll('select.addr_type')];
		slcs.forEach((slc)=>{
			if(slc.getAttribute('chg')=='false'){
				slc.selectedIndex=((typeof slcs1[0]!=='undefined')?slcs1[0].selectedIndex:12)
				addr_type_len(slc,slc.nextElementSibling);
			}
		});
		
		
		let sbd=[...scls.hl.querySelectorAll('.offst_pn')];
		let sb=sbd.map((d)=>{return [...d.children];});
		
		function sub_btns(up,sbd,i){
			if(up===true){
				let x1=parseInt(sbd[i+1].parentElement.parentElement.getAttribute('deco'));
				let x=parseInt(sbd[i].parentElement.parentElement.getAttribute('deco'));
				s=x-x1;
				let sd=s;
				let f=(s).toString(16).toLocaleUpperCase();
				if(s>=0){
				sd='+'+sd;
				f='+'+f;
				}
				let fd=(s>-10 && s<10)?f:(f+'	{'+sd+'}');
				sb[i][0].setAttribute('deco',s);
				sb[i][0].innerText='↑'+fd;
			}else{
				let x1=parseInt(sbd[i-1].parentElement.parentElement.getAttribute('deco'));
				let x=parseInt(sbd[i].parentElement.parentElement.getAttribute('deco'));
				s=x-x1;
				let sd=s;
				let f=(s).toString(16).toLocaleUpperCase();
				if(s>=0){
				sd='+'+sd;
				f='+'+f;
				}
				let fd=(s>-10 && s<10)?f:(f+'	{'+sd+'}');
				sb[i][1].setAttribute('deco',s);
				sb[i][1].innerText='↓'+fd;
			}
		}
		

		for (let i=0, len=sbd.length; i<len; i++ ){
			if(!(i===0 && len===1)){
				 if(i===0 && len>1){
					sub_btns(true,sbd,i);
				}else if(i===len-1){
					sub_btns(false,sbd,i);
				}else{
					sub_btns(true,sbd,i);
					sub_btns(false,sbd,i);
				}
			}
			sb[i][0].onclick=(event)=>{pnb_click(event)};
			sb[i][1].onclick=(event)=>{pnb_click(event)};
		}
		scr_left();
	}
}

function scrl_pos(){
		scls.ttl.innerText="Highlighted: ";
		scls.outer.style.border='2px outset hsl(46deg 90% 28%)';
		scls.ce.innerHTML=`<label style="display: flex;">Address group name: <div contenteditable="true"></div>
</label>
<label style="display: flex;">Module (executable) name: <div title="Leave empty to use 'aobscan(…)' instead of 'aobscanmodule(…)'" contenteditable="true"></div>
</label>
<label style="display: flex;">Array of bytes (from base address): <div contenteditable="true" oninput="base_AOB_chg(event);" ondblclick="sel_AOB(event);" chg="false" id="base_AOB">${(base_hx===null || base_hxi!=='')?base_hxi:base_hx+'…'}</div>
</label>
<button onclick="gen_ct(event);" style="margin-top: 0.7ch;margin-bottom: 0.7ch;">Generate Cheat Table</button>
<section id="srch">
<div style="margin-bottom: 0.6ch;font-weight: bold;">Auto-highlight:</div>
<select  id="auto_hl_slc0" oninput="auto_hl_slc(event,0);">
	<option>Byte unsigned</option>
	<option>Byte signed</option>
	<option>2 Bytes unsigned</option>
	<option>2 Bytes signed</option>
	<option>4 Bytes unsigned</option>
	<option>4 Bytes signed</option>
	<option>8 Bytes unsigned</option>
	<option>8 Bytes signed</option>
	<option>Float</option>
	<option>Double</option>
	<option>Character</option>
</select>
<select  id="auto_hl_slc1" oninput="auto_hl_slc(event,1);">
	<option>Between</option>
	<option>Exactly</option>
	<option>All</option>
	<option>Greater than or equal to</option>
	<option>Less than or equal to</option>
	<option>Not equal to</option>
	<option>In list (CSV)</option>
</select>
<div class="num" contenteditable="true" style="display:none;"></div>
<div class="num" contenteditable="true" style="display:none;"></div><br>
<label>Non-zero
<input type="checkbox"></input>
</label>
<label>Non-exponential float
<input type="checkbox"></input>
</label>
<button onclick="auto_hl(event);">Auto-highlight</button>
<button onclick="un_hl(event);">Un-highlight all</button>
</section>`;

let hls=document.getElementById('auto_hl_slc0');
hls.selectedIndex=8;
let hls1=document.getElementById('auto_hl_slc1');
hls1.selectedIndex=2;

		let dvs=[...document.querySelectorAll('section#anly_info > section div')].map((d)=>{return d.clientWidth;});
		let mx=Math.max(...dvs);
		let anlys_i_R=absBoundingClientRect(anlys_i);
		scls.outer.style.top=anlys_i_R.top+'px';
		scls.outer.style.left=(anlys_i_R.left+mx+5)+'px';	
}

function procPrint(){
	let len=hx_arr_int.length;
	let i=hx_arr_cnt;
	let df=hx_arr_int.length-i;
	let b;
	let brds={chr:'',gOff:i, one_byte:[], two_byte:[], four_byte:[], eight_byte:[],flts:[],interps:[], chrs:[],flt_txt:[]};
		
		if(df>=8){
			a=[hx_arr_int[i+7],hx_arr_int[i+6],hx_arr_int[i+5],hx_arr_int[i+4],hx_arr_int[i+3],hx_arr_int[i+2],hx_arr_int[i+1],hx_arr_int[i]];
			rhx=[hx_arr[i+7],hx_arr[i+6],hx_arr[i+5],hx_arr[i+4],hx_arr[i+3],hx_arr[i+2],hx_arr[i+1],hx_arr[i]];
			brds['eight_byte'].push(rhx);
			brds['eight_byte'].push(a);
			b=n_byte_unit8_to_int(rhx);
			let data =  a;
			let view = new DataView(new Uint8Array(data).buffer);
			brds['flts'].unshift([view.getFloat64(0)]); //will be rounded later
			brds['interps'].unshift(b);
		}else{
			brds['interps'].unshift(undefined);
		}
		if(df>=4){
			a=[hx_arr_int[i+3],hx_arr_int[i+2],hx_arr_int[i+1],hx_arr_int[i]];
			rhx=[hx_arr[i+3],hx_arr[i+2],hx_arr[i+1],hx_arr[i]];
			brds['four_byte'].push(rhx);
			brds['four_byte'].push(a);
			let data =  a;
			let view = new DataView(new Uint8Array(data).buffer);
			brds['flts'].unshift([view.getFloat32(0)]); //will be rounded later
			b=n_byte_unit8_to_int(rhx);
			brds['interps'].unshift(b);
			brds['chrs'].push(String.fromCharCode(b.u));
				let codePoint = [hx_arr[i+1]+hx_arr[i], hx_arr[i+3]+hx_arr[i+2]].reduce((acc, cur) => {
				cur = parseInt(cur, 16); return acc += cur<0xDC00 ? (cur-0xD7F7)<<10 : cur; //https://stackoverflow.com/posts/53882179/revisions | Mr Lister
				}, 0);
				try{
					brds['chrs'].unshift(String.fromCodePoint(codePoint));
				}catch(e){
					brds['chrs'].unshift(undefined);
				}
		}else{
			brds['interps'].unshift(undefined);
			brds['chrs'].push('');
		}
		if(df>=3){
			rhx=[hx_arr[i+2],hx_arr[i+1],hx_arr[i]];
			b=n_byte_unit8_to_int(rhx,true);
			brds['chrs'].push(String.fromCharCode(b.u));
		}else{
			brds['chrs'].push('');
		}
		if(df>=2){
			a=[hx_arr_int[i+1],hx_arr_int[i]];
			rhx=[hx_arr[i+1],hx_arr[i]];
			brds['two_byte'].push(rhx);
			brds['two_byte'].push(a);
			b=n_byte_unit8_to_int(rhx);
			brds['interps'].unshift(b);
			brds['chrs'].push(String.fromCharCode(b.u));
		}else{
			brds['interps'].unshift(undefined);
			brds['chrs'].push('');
		}
		a=[hx_arr_int[i]];
		rhx=[hx_arr[i]];
		brds['one_byte'].push(rhx);
		brds['one_byte'].push(a);
		b=n_byte_unit8_to_int(rhx);
		brds['chrs'].push(String.fromCharCode(b.u));
		brds['one_byte'].push(b);
		brds['interps'].unshift(b);
				
		let s=brds['gOff']-hxBse;
		let sd=s;
		let f=(s).toString(16).toLocaleUpperCase();
		if(s>=0){
			if(s===0){
				base_hx=brds['one_byte'][0];
			}
			sd='+'+sd;
			f='+'+f;
		}
		let fd=(s>-10 && s<10)?f:(f+'	{'+sd+'}');
		let tc='[';
		let c='';
		for (let i=4; i>=0; i--){
			c=((brds['chrs'][i]==='')?'❌':`"${brds['chrs'][i]}"`);
			tc=(c==='' || c==='"undefined"')?tc+'❌':tc+c;
			if(i>0){
				if(i<=4){
					tc+=' | ';
				}
			}else{
				tc+=']'
			}
		}
		let t1='['+getBarSepStr(brds['interps'],0,0)+']';
		let fs=[getBarSepStr(brds['flts'][0],0,7),getBarSepStr(brds['flts'][1],0,15)];
		brds['flt_txt']=[fs[0],fs[1]];
		let t2='['+fs[0]+' || '+fs[1]+']';
		
		anlys_i_HTML+='<section ix="'+all_hex.length+'" title="Double click to prime button for making this the base" abs_hex="'+i+'" ondblclick="base_cnd(event);" onclick="hl_sct(event);" style="display: flex;flex-flow: column;min-width: fit-content;"><div style="font-weight: bolder;" deco="'+s+'" hod="'+f+'" class="hex_offs" title="Offset" ondblclick="base_cnd(event);">'+fd+'</div><div ondblclick="base_cnd(event);">'+brds['one_byte'][0]+'</div><div ondblclick="base_cnd(event);" style="min-width: max-content;font-weight: bold;color: hsl(170deg 100% 50%);" title="[1 byte char | 2 byte char | 3 byte char | 4 byte char | 4 byte surrogate pair char ]">'+tc+'</div><div ondblclick="base_cnd(event);" style="min-width: max-content;font-weight: bold;color: hsl(170deg 100% 50%);" title="[1 byte int (unsigned, signed) | 2 byte int (unsigned, signed) | 4 byte int (unsigned, signed) | 8 byte int (unsigned, signed)]">'+t1+'</div><div ondblclick="base_cnd(event);" style="min-width: max-content;font-weight: bold;color: hsl(94deg 100% 50%);" title="[float || double]">'+t2+'</div></section>';
		all_hex.push(brds);
		hx_arr_cnt+=1;
		if(hx_arr_cnt<len){
			ttl.innerText="Hex converter - Loading: "+	(Math.floor((i/len)*10000)*0.01).toLocaleString('en-GB',{useGrouping: false, minimumFractionDigits: 2, maximumFractionDigits: 2})+"%";
			setTimeout(procPrint,0);
		}else{
			hx_arr_cnt=0;
			anlys_i.innerHTML=anlys_i_HTML;
			ttl.innerText="Hex converter";
			scrl_pos();
		}
}

hx.onclick=(event)=>{
	document.body.scrollLeft=0;
}

var scr_left=(left)=>{
	let scls_hl_R=absBoundingClientRect(scls.hl);
	document.body.scrollLeft=(left)?scls_hl_R.left:scls_hl_R.right-window.screen.availWidth;
}

scls.outer.onclick=(event)=>{
	scr_left(true);
}


	
hx.oninput=(event)=>{
	scls.hl.innerHTML='';
	base_hx=null;
	base_hxi='';
	fnd=[];
	all_hex=[];
	hx_arr=hx.innerText.toLocaleUpperCase().split(/\s+/).join('').match(/([0-9]|[A-F]){1,2}/g);
	hx.innerHTML='';
	if(hx_arr!== null && hx_arr.length>0){
		hx_arr=hx_arr.map((x)=>{return x.trim();}).filter((x)=>{return x!=='';});
		let hxtm='';
			hxtm+='<span class="base_span" ix="1">'+hx_arr[0]+' </span>';
		for(let i=1, len=hx_arr.length; i<len; i++){
				hxtm+='<span  ix="'+(i+1)+'">'+hx_arr[i]+' </span>';
		}
		hx.innerHTML=hxtm;

		hx_arr_int=[];
		hx_arr_cnt=0;
			
		let a=[];
		let rhx=[];
		hx_arr_int=hx_arr.map((x)=>{return lookup_hex[x]});
		anlys_i.innerHTML='';
		anlys_i_HTML='';
		if(hx_arr_int.length>0){
			procPrint();
		}
		console.log(all_hex);
	}

    selDivEditable(hx);
}


hx.onpointerdown=(event)=>{
	clk_hx(event);
}

sbse.onclick=(event)=>{
	hxBse_raw=sbse.getAttribute('baseByte');
	hxBse=parseInt(hxBse_raw);
	let bsps=[...document.querySelectorAll('#hex span')];
	for(let i=0, len=bsps.length; i<len; i++){
		let b=bsps[i];
		if(b.getAttribute('ix') === hxBse_raw){
			b.classList.add('base_span');
		}else if(b.classList.contains('base_span')){
			b.classList.remove('base_span');
		}
	}
	let f=[...document.getElementsByClassName('hex_offs')];
	for(let i=0, len=f.length; i<len; i++){
		let sp=f[i].parentElement;
		let s=parseInt(sp.getAttribute('abs_hex'))-hxBse+1;
		let sd=s;
		let fd=(s).toString(16).toLocaleUpperCase();
		if(s>=0){
			if(s===0){
				base_hx=f[i].nextElementSibling.innerText;
				let p=[...scls.ce.querySelectorAll('#base_AOB')][0];
					if(p.innerText.toLocaleUpperCase().split(/\s+/).join('').match(/([0-9]|[A-F]){1,2}/g)[0]!==base_hx){
						p.innerText=base_hx+'…';
						base_hxi='';
					}
			}
			sd='+'+sd;
			fd='+'+fd;
		}
		
		f[i].setAttribute('hod',fd);
		f[i].setAttribute('deco',s);
		fd=(s>-10 && s<10)?fd:(fd+'	{'+sd+'}');
		let k=[...document.querySelectorAll('section#anly_info > section.tracked')];
		k.forEach((ks)=>{
			ks.classList.remove('tracked');
		});
		f[i].innerText=fd;
	}
	scls.hl.innerHTML='';
}
jmbs.onclick=(event)=>{
	let f=[...document.getElementsByClassName('hex_offs')];
	let ix=f.findIndex((h)=>{return h.getAttribute('hod')==='+0';});
	if(ix>=0){
		f[ix].parentElement.scrollIntoView();
	}

}

function isEditableDiv(d){
	return (d.nodeName==='DIV' && d.contentEditable==='true')?true:false;
}

if (typeof observer === "undefined") {
	const observer = new MutationObserver((mutations) => {
		if(pastd.length>0){
			let fnd_els=[];
				
			for(let i=0, len=mutations.length; i<len;i++){
					if(pastd.length>0){
						let t=mutations[i].target;
						if(pastd.includes(t)){
							pastd=pastd.filter((p)=>{return p!==t;});
							fnd_els.push(t);
						}/*else{
							let d=[...t.addedNodes];
							let dvs=d.filter((n)=>{return isEditableDiv(n); } ); if(dvs.length>0){
									for(let k=0, len_k=dvs.length; k<len_k;k++){
										fnd_els.push(dvs[k]);
									}
							}
						}*/
				}else{
					i=len-1;
				}
			}			
			
			for(let k=0, len_k=fnd_els.length; k<len_k;k++){
					let f=fnd_els[k];
				
					if(!['hex','hex_search_AOB','base_AOB'].includes(f.id)){
						f.innerHTML=f.innerText;
					}else if(['base_AOB','hex_search_AOB'].includes(f.id)){	f.innerHTML=f.innerText.toLocaleUpperCase().split(/\s+/).join('').match(/([0-9]|[A-F]){1,2}/g).join(' ');
					}
			}
		}
	});
		observer.observe(document, {
			subtree: true,
			childList: true,
			attributes: true,
			attributeOldValue: true,
			characterData: true,
			characterDataOldValue: true
		});
}

window.addEventListener("paste", function(e) {
	let t=e.target;
	if( isEditableDiv(t) ){
		pastd.push(t);
	}
});

</script>

</body>

</html>